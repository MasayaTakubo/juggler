#include <stdio.h>
#include <stdlib.h>
#include <time.h>

// ???[????V???{???i?G???j
char symbols[] = {'7', 'B', 'C', 'L', 'O', 'X', 'A', 'S', 'D', 'F'};

// ?????_????V???{?????
char generateRandomSymbol() {
    int randomIndex = rand() % 10; // ?V???{??????i0????9????????????j
    return symbols[randomIndex];
}

// ???[?U?????[????????
char userSpinReel() {
    char input;
    printf("???[????????????L?[???????????????...\n");
    scanf(" %c", &input);
    return generateRandomSymbol();
}

int main() {
    int coins = 0;
    int spins = 0;
    int regularBonuses = 0;
    int bigBonuses = 0;
    int reelCount = 3; // ???[?????
    int bigBonusProbability = 120; // BIG?{?[?i?X??m??
    int regularBonusProbability = 120; // ???M?????[?{?[?i?X??m??
    int totalBigBonuses = 0; // BIG?{?[?i?X????v
    int totalRegularBonuses = 0; // ???M?????[?{?[?i?X????v
    int initialAmount;
    int reels[3];
    char addMoney;
    int addAmount;
    int j;
    int totalBonuses;
    int year, month, day;
    FILE *file;


    time_t timer;        /* ?????????o???????^?i?????unsigned long?^?j */
    struct tm *local;    /* tm?\????i?????????? */

    /* ?N??????????b????p */

    timer = time(NULL);        /* ??????????ï */
    local = localtime(&timer);    /* ?n???????? */

    /* ?N??????????b??tm?\?????e?p?????^?????????? */
    year = local->tm_year + 1900;        /* 1900?N?????N?????ï??????? */
    month = local->tm_mon + 1;        /* 0??1???????????? */
    day = local->tm_mday;


    file = fopen("jaglog.txt", "a");
    if (file == NULL) {
        printf("?t?@?C?????J????????????B\n");
        return 1;
    }


    // ???????????V?[?h????
    srand(time(NULL));



    printf("???????????????????H (1000?~??10000?~???): ");
    scanf("%d", &initialAmount);

    if (initialAmount == 1000) {
        coins = 50; // 1000?~??50?R?C????
    } else if (initialAmount == 10000) {
        coins = 500; // 10000?~??500?R?C????
    } else {
        printf("1000?~??10000?~???????????????????????B\n");
        return 1;
    }

    while (1) {
        printf("?????R?C??: %d\n", coins);

        if (coins < 3) {
            printf("?R?C??????????????????B\n");
            printf("????????????????H (y/n): ");
            scanf(" %c", &addMoney);
            if (addMoney == 'y' || addMoney == 'Y') {
                printf("????????????????H (1000?~??10000?~???): ");
                scanf("%d", &addAmount);

                if (addAmount == 1000) {
                    coins += 50; // 1000?~??50?R?C?????
                } else if (addAmount == 10000) {
                    coins += 500; // 10000?~??500?R?C?????
                } else {
                    printf("1000?~??10000?~???????????????????????B\n");
                    return 1;
                }
            } else {
                /* ??????????\?? */
                fprintf(file,"%d?N%d??%d??\n", year, month, day);

                fprintf(file,"BIG %d\t", totalBigBonuses);
                fprintf(file,"REG %d\t", totalRegularBonuses);
                fprintf(file,"????]?? %d\n", spins);
                fprintf(file,"???Z: %d/%d\n", totalBonuses, spins);


                // ?t?@?C????????
                fclose(file);
                break;
            }
        }

        // 3?R?C?????g??????[????3???
        coins -= 3;
        printf("3?R?C?????g??????[?????????B\n");



        // ???[???????[?U???˜@?????
        for (j = 0; j < 3; j++) {
            reels[j] = userSpinReel();
            printf("???[??%d: %c\n", j + 1, reels[j]);
        }

        spins++;

        // BIG?{?[?i?X??m????????????
        if (rand() % bigBonusProbability == 0) {
            printf("BIG?{?[?i?X?I\n");
            coins += 250; // BIG?{?[?i?X??250??????
            bigBonuses++;
            totalBigBonuses++;
        }
            // ???M?????[?{?[?i?X??m????????????
        else if (rand() % regularBonusProbability == 0) {
            printf("??????????I???M?????[?{?[?i?X?I\n");
            coins += 100; // ???M?????[?{?[?i?X??100??????
            regularBonuses++;
            totalRegularBonuses++;
        }
        else {
            printf("?n?Y???I\n");
        }

        // ?m????????????A?????????
        if (spins % bigBonusProbability == 0) {
            bigBonusProbability = 120;
        }
        if (spins % regularBonusProbability == 0) {
            regularBonusProbability = 120;
        }

        //BIG,REG,????]????\??
        printf("BIG %d\t", totalBigBonuses);
        printf("REG %d\t", totalRegularBonuses);
        printf("????]?? %d\n", spins);

        // ???Z??\???i?r?b?O?{?[?i?X???v+???M?????[?{?[?i?X???v / ??]???j
        totalBonuses = totalBigBonuses + totalRegularBonuses;
        printf("???Z: %d/%d\n", totalBonuses, spins);

    }

    return 0;
}